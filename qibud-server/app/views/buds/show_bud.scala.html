@(bud: _root_.buds.Bud)

@import tags._
@import _root_.views.tools._

@sidebar = {
    <h3 class="pull-left" style="padding-right: 1em; font-weight: bold">Qi</h3>
    <div class="progress progress-striped active" style="margin-top:0.4em">
        <div class="bar" style='width: 50%;'>@bud.graphNode().getQi()</div>
    </div>
    @if( bud.attachments().isEmpty() ) {
        <p>No attachments.</p>
    }
    @if( ! bud.attachments().isEmpty() ) {
        <h3>Attachments</h3>
        @for( eachAttachment <- bud.attachments() ) {
            <p>
                <span style="font-weight: bold">@eachAttachment.filename()</span>
                <br/>
                <small>@eachAttachment.md5()</small>
            </p>
            @if( eachAttachment.contentType() == null ) {
                <p class="pull-right" style="padding-left: 1em"><a href="@routes.Buds.attachment( bud.identity(), eachAttachment.id() )" class="btn btn-mini">Download</a></p>
                <div class="progress progress-danger progress-striped active">
                    <div class="bar" style='width: 100%;'>Gathering metadata</div>
                </div>
            }
            @if( eachAttachment.contentType() != null ) {
                <div class="accordion" id='attachment-@eachAttachment.id()-metadata'>
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent='#attachment-@eachAttachment.id()-metadata' href="#attachment-@eachAttachment.id()-metadata-collapse">Metadata</a>
                        </div>
                        <div id="attachment-@eachAttachment.id()-metadata-collapse" class="accordion-body in collapse">
                            <div class="accordion-inner">
                                <table class="table table-condensed table-striped">
                                    <thead>
                                        <tr>
                                            <th>Key</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for( meta <- eachAttachment.metadata() ) {
                                            <tr>
                                                <td>@meta._1</td>
                                                <td>@meta._2</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <p style="text-align:right"><a href="@routes.Buds.attachmentMetadata( bud.identity(), eachAttachment.id() )" target="_blank" class="btn btn-mini">As JSON</a></p>
                            </div>
                        </div>
                    </div>
                </div>
                @img( routes.Buds.attachment( bud.identity(), eachAttachment.id() ).toString() )
            }
            
        }
    }
}

@main( bud.entity().title, "buds" ) {

    @layout_fluid(right_sidebar = sidebar) {
    
        @page_header(bud.entity().title)
        
        <p>
            <a href="@routes.Buds.budEditForm( bud.identity() )" class="btn btn-mini btn-primary">Edit</a>
            @if( bud.isRoot() ) {
                <a class="btn btn-mini btn-danger disabled" title="You cannot delete the root Bud">Delete</a>
            }
            @if( ! bud.isRoot() ) {
                <a href="@routes.Buds.deleteBud( bud.identity() )" class="btn btn-mini btn-danger">Delete</a>
            }
        </p>

        @markdown( bud.entity().content )
 
    }
    
}