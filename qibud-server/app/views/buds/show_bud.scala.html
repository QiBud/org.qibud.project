@( budview: _root_.views.BudViewData )

@import tags._
@import _root_.play.libs._
@import _root_.views.tools._

@scripts = {
    <script type="text/javascript">
        $(document).ready( function() {
            @if( ! budview.roles.isEmpty() ) {
                @for( role <- budview.roles ) {
                    if( roles.packs.@(role.budPackName()) && roles.packs.@(role.budPackName()).@(role.roleName()) ) {
                        roles.budRole( "@budview.bud.identity().get()", "@(role.budPackName())", "@(role.roleName())", function( data ) {
                            roles.packs.@(role.budPackName()).@(role.roleName()).inject_view(
                                '@budview.bud.identity().get()',
                                '@(role.idname())-view-placeholder',
                                data.descriptor,
                                data.state
                            );
                        } );
                    }
                }
            }
        } );
    </script>
}

@bud_content = {

    @if( budview.bud.parent().get() == null ) {
        @page_header( budview.bud.title().get() )
    }
    @if( budview.bud.parent().get() != null ) {
        @page_header( budview.bud.title().get(),
                      btn_route = routes.Buds.bud( budview.bud.parent().get().identity().get() ),
                      btn_icon = "icon-chevron-left",
                      btn_title = budview.bud.parent().get().title().get() )
    }

    <p>
        @if( budview.accountCanWrite() ) {
            <a href="@routes.Buds.budCreateForm( budview.bud.identity().get() )" class="btn btn-mini btn-primary"><i class="icon-plus"></i> New</a>
            <a href="@routes.Buds.budEditForm( budview.bud.identity().get() )" class="btn btn-mini btn-primary"><i class="icon-edit"></i> Edit</a>
            <a href="@routes.Buds.deleteBud( budview.bud.identity().get() )" class="btn btn-mini btn-danger">Delete</a>
        }
    </p>

    @markdown( budview.bud.content().get() )
}

@main( budview.bud.title().get(), "buds", scripts ) {

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span9">
                @bud_content
            </div>
            <div class="span3">
                <div class="well" style="min-height: 400px">
                    @show_bud_sidebar( budview )
                </div>
            </div>
        </div>
    </div>

}
