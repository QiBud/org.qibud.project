@(bud: _root_.domain.buds.Bud)

@import tags._
@import _root_.views.tools._

@sidebar = {
    @show_bud_sidebar( bud )
}

@scripts = {
    <script type="text/javascript">
        $(document).ready( function() {

            var width = 500, height = 200;

            var cluster = d3.layout.cluster().size([height, width - 100]);

            var diagonal = d3.svg.diagonal().projection(function(d) { return [d.y, d.x]; });

            var vis = d3.select("#bud-graph-@bud.identity()").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(40, 0)");

            var nodes = cluster.nodes({
                "name": "@bud.title()"
            });

            var link = vis.selectAll("path.link")
            .data(cluster.links(nodes))
            .enter().append("path")
            .attr("class", "link")
            .attr("d", diagonal);

            var node = vis.selectAll("g.node")
            .data(nodes)
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })

            node.append("circle")
            .attr("r", 4.5);

            node.append("text")
            .attr("dx", function(d) { return d.children ? -8 : 8; })
            .attr("dy", 3)
            .attr("text-anchor", function(d) { return d.children ? "end" : "start"; })
            .text(function(d) { return d.name; });
        });
    </script>
}

@main( bud.title().get(), "buds", scripts ) {

    @layout_fluid( right_sidebar = sidebar ) {

        @page_header( bud.title().get() )

        <h3 style="padding-right: 1em; font-weight: bold">Graph</h3>
        <div id="bud-graph-@bud.identity()"></div>

        <p>
            <a href="@routes.Buds.budCreateForm( bud.identity().get() )" class="btn btn-mini btn-primary"><i class="icon-plus"></i> New</a>
            <a href="@routes.Buds.budEditForm( bud.identity().get() )" class="btn btn-mini btn-primary"><i class="icon-edit"></i> Edit</a>
            @if( bud.isRoot() ) {
                <a class="btn btn-mini btn-danger disabled" title="You cannot delete the root Bud"><i class="icon-trash"></i> Delete</a>
            }
            @if( ! bud.isRoot() ) {
                <a href="@routes.Buds.deleteBud( bud.identity().get() )" class="btn btn-mini btn-danger">Delete</a>
            }
        </p>

        @markdown( bud.content().get() )

    }

}